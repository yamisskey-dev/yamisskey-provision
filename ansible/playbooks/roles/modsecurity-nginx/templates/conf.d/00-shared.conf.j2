# Shared configurations for all ModSecurity-Nginx services
# This file contains common settings used across all service configurations

# WebSocket upgrade map
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

# Proxy cache for static content
proxy_cache_path /tmp/nginx_cache levels=1:2 keys_zone=cache1:32m max_size=2g inactive=1440m use_temp_path=off;

# Rate limiting zones (defined globally)
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/s;
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=500r/s;
limit_req_zone $binary_remote_addr zone=media_limit:10m rate=200r/s;

# Common proxy settings (can be included in server blocks)
# Note: These are reference settings, individual configs override as needed
proxy_http_version 1.1;
proxy_set_header Connection "";

# Common security headers (reference)
# add_header X-Frame-Options "SAMEORIGIN" always;
# add_header X-Content-Type-Options "nosniff" always;
# add_header X-XSS-Protection "1; mode=block" always;
# add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Common timeouts (reference)
# proxy_connect_timeout 30s;
# proxy_send_timeout 60s;
# proxy_read_timeout 60s;
